# Руководство пользователя CrossNext

## Назначение
CrossNext — веб‑приложение для ведения словаря слов и определений (в том числе с тегами, сложностью и сроком действия).

## Вход и сессия
- Вход: `/{locale}/auth/sign-in` (логин/пароль).
- Выход: кнопка `Logout` в верхней панели.
- Если сессия истекла, приложение покажет уведомление и перенаправит на страницу входа.

## Навигация и верхняя панель
- `Dictionary` — основной словарь.
- `New` (Pending) — заявки на добавление/изменение (если есть права).
- `Admin Panel` — администрирование (если есть права).
- `Upload` — загрузка файлов `.fsh` (обычно только для админов).
- Переключатели: язык интерфейса (ru/uk/en) и светлая/темная тема.

## Словарь (Dictionary)

### Язык словаря
Верхний селект на странице словаря задает язык данных (из БД). Он независим от языка интерфейса. Фильтры и поиск применяются к выбранному языку словаря.

### Поиск и фильтры
- Поиск по словам и/или определениям.
- `Scope`: искать по словам, по определениям или по обоим.
- `Match`: `Contains`, `Starts with`, `Exact`.
- `Tags`: фильтрация по тегам (по определениям).
- `Difficulty`: диапазон от/до.
- `Length filter`: длина слова или определения (мин/макс).
- `Length sort`: сортировка по длине.
- `Reset filters`: сброс всех фильтров.

### Сортировка списка
- По словам (A–Z / Z–A).
- По определениям (A–Z / Z–A).
- Счетчики рядом показывают общее количество слов и определений в текущем результате.

### Просмотр списка
- Показываются только не удаленные слова и активные (не просроченные) определения.
- Если у слова много определений, доступна кнопка `more N…` для раскрытия всех.
- Кнопка `Collapse` сворачивает список обратно.
- Кнопка `Load more` подгружает следующую порцию.

### Добавление нового слова
1) Нажмите `New`.
2) Заполните `Word`:
   - разрешены только буквы,
   - пробелы удаляются,
   - текст приводится к нижнему регистру.
3) Добавьте одно или несколько определений:
   - текст определения (до 255 символов),
   - заметка (опционально),
   - сложность,
   - срок действия (End date),
   - теги.
4) Нажмите `Create`.

Результат: создается заявка на модерацию (Pending).

### Добавление определения к существующему слову
1) Нажмите `+` рядом со словом.
2) Заполните форму определения (можно добавить несколько).
3) При необходимости используйте:
   - `AI` для генерации определения,
   - блок `Similar definitions` для проверки на дубликаты.
4) Нажмите `Create`.

Особенности:
- На десктопе панель плавающая (перетаскиваемая и изменяемая по размеру).
- На мобиле — полноэкранный режим.
- Можно свернуть окно; одновременно может быть только одно свернутое окно добавления.

### Редактирование слова и определения
- Карандаш у слова/определения открывает редактирование.
- Изменение текста слова/определения и заметки создает заявку на модерацию.
- Если для слова/определения уже есть заявка, кнопка редактирования может быть скрыта.
- Изменение сложности и срока действия определения применяется сразу (без заявки).

### Теги
У определения можно:
- открыть редактор тегов (иконка `#`),
- выбрать существующие теги,
- создать новый тег, введя имя и подтвердив.

### Массовое добавление тегов
Доступно только пользователям с правами на администрирование тегов.
1) Включите режим `Bulk tag mode` (кнопка `#` в фильтрах).
2) Выберите теги, которые нужно применить.
3) Отметьте определения чекбоксами.
4) (Опционально) выберите все определения по текущему фильтру.
5) Нажмите `Apply tags`.

Результат: выбранные теги добавятся ко всем выбранным определениям.

### Удаление
- `Delete` у слова удаляет слово и все его определения (перемещает в корзину).
- `Delete` у определения удаляет только это определение (перемещает в корзину).
- Восстановление и окончательное удаление доступны в `Admin Panel → Trash`.

## Pending (Заявки)
Заявки создаются при:
- добавлении нового слова,
- добавлении новых определений,
- редактировании текста слова или определения.

Что видно на карточке:
- слово, язык, тип операции (Add/Edit),
- автор и дата,
- список определений и их параметры.

Действия:
- `Edit` (иконка карандаша) — редактирование карточки перед подтверждением:
  - можно править слово, определения, теги, сложность, срок действия;
  - можно пометить определение на удаление в заявке.
- `Save` — сохраняет изменения в заявке.
- `Approve` / `Reject` — доступны пользователям с правом `pending:review`.

Если прав нет, видны только собственные заявки и отсутствуют кнопки утверждения.

## Admin Panel
Доступно пользователям с правом `admin:access`. Вверху можно выбрать язык данных.

### Expired
- Список определений, срок действия которых истек.
- Можно изменить сложность и срок действия и сохранить.
- Можно выбрать несколько определений и продлить их массово.
- `Delete` перемещает определение в корзину.

### Trash
- Удаленные слова и определения.
- `Restore` возвращает объект.
- Массовое удаление удаляет навсегда (подтверждается вводом слова `DELETE`).

### Tags
- Поиск, сортировка и просмотр тегов по количеству определений.
- `Merge` — перенос определений из одного тега в другой.
- `Delete` — удаление тега (с подтверждением).
- `Remove definition` — убрать связь тега с конкретным определением.
- `Bulk tag add` — добавить выбранный тег ко всем определениям, у которых уже есть выбранные теги.
- `Delete empty tags` — удалить все пустые теги (с подтверждением).

### Users
- Создание пользователя (логин, email, пароль, роль).
- Просмотр списка пользователей и их прав.
- Редактирование роли и пароля.
- Отключение/включение пользователя.

### Stats
- Статистика изменений по месяцам и пользователям.
- Можно раскрывать месяцы и пользователей для детализации.

## Upload
Страница загрузки поддерживает `.fsh` файлы:
- drag&drop или клик по зоне загрузки,
- показ статистики по длинам слов (общей и по файлам),
- удаление файла из списка,
- `Upload` отправляет файлы на сервер.

## Подсказки и частые вопросы
- Не вижу кнопки редактирования: нет прав или уже существует заявка на изменение.
- Определение исчезло из словаря: возможно, истек срок действия — проверьте `Admin Panel → Expired`.
- AI‑генерация не работает: требуется вход и настройка AI‑провайдера; возможна квота/ограничение.
- Фильтры и язык словаря сохраняются в браузере и восстанавливаются при следующем входе.
